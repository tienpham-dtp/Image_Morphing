'''
  File name: click_correspondences.py
  Author: 
  Date created: 
'''

'''
  File clarification:
    Click correspondences between two images
    - Input im1: target image
    - Input im2: source image
    - Output im1_pts: correspondences coordiantes in the target image
    - Output im2_pts: correspondences coordiantes in the source image
'''
import matplotlib.pyplot as plt
import numpy as np
from cpselect import cpselect
from PIL import Image
import pandas as pd
import numpy as np


import matplotlib.pyplot as plt
import numpy as np
from skimage import transform
def click_correspondences(im1, im2):
  '''
    Tips:
      - use 'matplotlib.pyplot.subplot' to create a figure that shows the source and target image together
      - add arguments in the 'imshow' function for better image view
      - use function 'ginput' and click correspondences in two images in turn
      - please check the 'ginput' function documentation carefully
        + determine the number of correspondences by yourself which is the argument of 'ginput' function
        + when using ginput, left click represents selection, right click represents removing the last click
        + click points in two images in turn and once you finish it, the function is supposed to 
          return a NumPy array contains correspondences position in two images
  '''

  # TODO: Your code here
  #im1_pts, im2_pts = cpselect(im1, im2)

  img1 = transform.resize(im1, [300, 300])
  img2 = transform.resize(im2, [300, 300])
  fig = plt.figure()
  a = fig.add_subplot(1, 2, 1)
  imgplot = plt.imshow(img1)
  a = fig.add_subplot(1, 2, 2)
  imgplot = plt.imshow(img2)
  #t = np.arange(300)
  #plt.plot(t, np.sin(t))
  print("Please click")
  x = plt.ginput(120, timeout = 0)
  print("clicked", x)
  plt.show()
  return x


#[(146.4032258064516, 221.2967741935484), (164.6935483870967, 170.73325830418906), (168.75806451612902, 221.2967741935484), (187.04838709677415, 175.5235808848342), (195.9032258064516, 227.68387096774194), (209.4032258064516, 173.92680669128583), (223.04838709677415, 227.68387096774194), (230.1612903225806, 177.1203550783826), (167.1612903225806, 254.8290322580645), (182.25806451612902, 207.45906475580193), (194.30645161290317, 251.63548387096773), (214.1935483870967, 207.45906475580193), (168.75806451612902, 275.5870967741935), (175.8709677419355, 228.21712927193096), (192.70967741935482, 273.99032258064517), (218.98387096774184, 229.81390346547937), (179.93548387096774, 283.5709677419355), (195.0322580645161, 242.58809701386645), (181.5322580645161, 266.0064516129032), (198.2258064516128, 217.0397099170923), (181.5322580645161, 296.3451612903226), (198.2258064516128, 263.34616152999547), (133.6290322580645, 275.5870967741935), (143.9354838709677, 228.21712927193096), (223.04838709677415, 277.18387096774194), (231.75806451612902, 239.39454862676968), (125.64516129032256, 254.8290322580645), (135.95161290322574, 218.63648411064065), (234.22580645161287, 262.81290322580645), (236.54838709677415, 225.0235808848342), (108.0806451612903, 232.47419354838712), (123.17741935483866, 196.2816454009632), (112.87096774193546, 205.3290322580645), (123.17741935483866, 177.1203550783826), (111.27419354838707, 152.63548387096773), (121.58064516129025, 129.21712927193101), (154.38709677419354, 117.50645161290322), (161.5, 87.70100023967291), (218.25806451612902, 117.50645161290322), (233.35483870967732, 81.31390346547937), (251.79032258064512, 151.03870967741938), (255.70967741935476, 127.6203550783826), (259.7741935483871, 200.53870967741938), (260.5, 157.95906475580193), (266.1612903225806, 213.31290322580645), (250.91935483870964, 181.91067765902778), (262.96774193548384, 245.2483870967742), (249.32258064516122, 202.6687421751568), (179.93548387096774, 157.4258064516129), (191.83870967741927, 111.65261314289876), (132.0322580645161, 174.99032258064517), (159.9032258064516, 130.81390346547937), (240.6129032258064, 168.60322580645163), (230.1612903225806, 132.41067765902778), (136.82258064516128, 206.9258064516129), (161.5, 156.36229056225358), (163.96774193548384, 203.73225806451615), (193.4354838709677, 161.15261314289876), (151.19354838709677, 197.3451612903226), (175.8709677419355, 148.37841959451163), (202.29032258064512, 210.11935483870968), (211.0, 161.15261314289876), (219.85483870967738, 205.3290322580645), (223.77419354838707, 153.1687421751568), (239.01612903225805, 216.50645161290322), (236.54838709677415, 162.7493873364471), (111.27419354838707, 291.5548387096774), (119.98387096774195, 292.08809701386645), (140.01612903225805, 286.76451612903224), (145.5322580645161, 256.95906475580193), (221.4516129032258, 288.36129032258066), (215.79032258064512, 272.92680669128583), (247.0, 291.5548387096774), (231.75806451612902, 317.63648411064065), (61.774193548387075, 301.13548387096773), (44.93548387096769, 324.0235808848342), (288.51612903225805, 307.52258064516127), (274.8709677419354, 341.58809701386645), (130.43548387096774, 307.52258064516127), (145.5322580645161, 324.0235808848342), (189.51612903225805, 317.10322580645163), (185.45161290322574, 343.1848712074148), (227.83870967741933, 297.94193548387096), (220.58064516129025, 319.233258304189)]
img1 = np.array(Image.open('baby.jpg'))
img2 = np.array(Image.open('cat.jpg'))

x = click_correspondences(img1, img2)

#pts1 = [x[i] for i in range(x.shape[0]) if i%2 != 0]
#pts2 = [x[i] for i in range(x.shape[0]) if i%2 == 0]
#pd.to_csv(pd.DataFrame(im_pts1))
#pd.to_csv(pd.DataFrame(im_pts2))

